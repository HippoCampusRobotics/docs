<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
    <link href="../../_static/hippo.svg" rel="icon" type="image/svg+xml">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>11.1.2. Installing PX4 &mdash; HippoCampusDocs  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/asciinema-player_2.6.1.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/asciinema-custom.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/tabs.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script src="../../_static/asciinema-player_2.6.1.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
        <script src="../../_static/tabs.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="11.1.3. Installing QGroundControl" href="installing_qgc.html" />
    <link rel="prev" title="11.1.1. Installing ROS" href="installing_ros.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            HippoCampusDocs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../00_main_toc/contributing.html">1. Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_main_toc/getting_started.html">2. Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_main_toc/concepts.html">3. Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_main_toc/raspberry_pi_4b_setup.html">4. Raspberry Pi 4B Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_main_toc/hippocampus_hardware.html">5. HippoCampus Hardware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_main_toc/bluerov.html">6. BlueROV</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_main_toc/gantry.html">7. Gantry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_main_toc/underwater_camera.html">8. Underwater Camera</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_main_toc/ros2.html">9. ROS2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../00_main_toc/misc.html">10. Misc</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../00_main_toc/ros_deprecated.html">11. ROS Deprecated</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../getting_started.html">11.1. Getting Started</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="installing_ros.html">11.1.1. Installing ROS</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">11.1.2. Installing PX4</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#get-the-code">Get The Code</a></li>
<li class="toctree-l4"><a class="reference internal" href="#export-environment-variables">Export Environment Variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-the-code">Build The Code</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sensible-modifications">Sensible Modifications</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="installing_qgc.html">11.1.3. Installing QGroundControl</a></li>
<li class="toctree-l3"><a class="reference internal" href="starting_gazebo_simulation.html">11.1.4. Starting Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="deploying_hippocampus.html">11.1.5. Deploying HippoCampus</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../raspberry_pi_4b_setup.html">11.2. Raspberry Pi 4B Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workflow_and_style_guide.html">11.3. Workflow and Style Guide</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">HippoCampusDocs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
           <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../00_main_toc/ros_deprecated.html"><span class="section-number">11. </span>ROS Deprecated</a></li>
          <li class="breadcrumb-item"><a href="../getting_started.html"><span class="section-number">11.1. </span>Getting Started</a></li>
      <li class="breadcrumb-item active"><span class="section-number">11.1.2. </span>Installing PX4</li>
    
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/HippoCampusRobotics/docs/blob/master/ros_deprecated/getting_started/installing_px4.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
    <li class="wy-breadcrumbs-aside"><a href="https://hippocampusrobotics.github.io/" class="fa fa-github"> Project Page </a></li>

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="installing-px4">
<h1><span class="section-number">11.1.2. </span>Installing PX4<a class="headerlink" href="#installing-px4" title="Permalink to this heading"></a></h1>
<p>We try to stick to the original PX4 software as much as possible.</p>
<p>Feel free to modifiy your fork of the autopilot as much as you want, but if you add functionality, that should be shared with the rest of the world, create a pull request.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following instructions assume, you want to clone the PX4-Autopilot in your home directory. If you don’t, you have to modifiy the instructions accordingly.</p>
</div>
<section id="get-the-code">
<h2>Get The Code<a class="headerlink" href="#get-the-code" title="Permalink to this heading"></a></h2>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>--branch<span class="w"> </span>v1.12.3<span class="w"> </span>--recursive<span class="w"> </span>https://github.com/PX4/PX4-Autopilot.git
</pre></div>
</div>
</section>
<section id="export-environment-variables">
<h2>Export Environment Variables<a class="headerlink" href="#export-environment-variables" title="Permalink to this heading"></a></h2>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">PX4_DIR</span><span class="o">=</span><span class="nv">$HOME</span>/PX4-Autopilot
</pre></div>
</div>
<p>Choose the option depending on your shell:</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-enNo" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-0-enNo" name="enNo" role="tab" tabindex="0">zsh</button><button aria-controls="panel-0-YmFzaA==" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-0-YmFzaA==" name="YmFzaA==" role="tab" tabindex="-1">bash</button></div><div aria-labelledby="tab-0-enNo" class="sphinx-tabs-panel code-tab group-tab" id="panel-0-enNo" name="enNo" role="tabpanel" tabindex="0"><div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;source </span><span class="nv">$PX4_DIR</span><span class="s2">/Tools/setup_gazebo.bash </span><span class="nv">$PX4_DIR</span><span class="s2"> </span><span class="nv">$PX4_DIR</span><span class="s2">/build/px4_sitl_default &gt; /dev/null&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.zshrc
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export ROS_PACKAGE_PATH=\$ROS_PACKAGE_PATH:</span><span class="nv">$PX4_DIR</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.zshrc
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export ROS_PACKAGE_PATH=\$ROS_PACKAGE_PATH:</span><span class="nv">$PX4_DIR</span><span class="s2">/Tools/sitl_gazebo&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.zshrc
</pre></div>
</div>
</div><div aria-labelledby="tab-0-YmFzaA==" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-0-YmFzaA==" name="YmFzaA==" role="tabpanel" tabindex="0"><div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;source </span><span class="nv">$PX4_DIR</span><span class="s2">/Tools/setup_gazebo.bash </span><span class="nv">$PX4_DIR</span><span class="s2"> </span><span class="nv">$PX4_DIR</span><span class="s2">/build/px4_sitl_default &gt; /dev/null&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bashrc
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export ROS_PACKAGE_PATH=\$ROS_PACKAGE_PATH:</span><span class="nv">$PX4_DIR</span><span class="s2">&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bashrc
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export ROS_PACKAGE_PATH=\$ROS_PACKAGE_PATH:</span><span class="nv">$PX4_DIR</span><span class="s2">/Tools/sitl_gazebo&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bashrc
</pre></div>
</div>
</div></div>
</section>
<section id="build-the-code">
<h2>Build The Code<a class="headerlink" href="#build-the-code" title="Permalink to this heading"></a></h2>
<p>Set up dependencies:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/PX4-Autopilot<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>bash<span class="w"> </span>./Tools/setup/ubuntu.sh
</pre></div>
</div>
<p>Install <code class="code docutils literal notranslate"><span class="pre">xmlstarlet</span></code> and <code class="code docutils literal notranslate"><span class="pre">python3-pip</span></code>:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>xmlstarlet<span class="w"> </span>python3-pip
</pre></div>
</div>
<p>Go to the firmware directory</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/PX4-Autopilot
</pre></div>
</div>
<p>Build the firmware</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-RmlybXdhcmUgZm9yIHNpbXVsYXRpb24=" aria-selected="true" class="sphinx-tabs-tab code-tab group-tab" id="tab-1-RmlybXdhcmUgZm9yIHNpbXVsYXRpb24=" name="RmlybXdhcmUgZm9yIHNpbXVsYXRpb24=" role="tab" tabindex="0">Firmware for simulation</button><button aria-controls="panel-1-RmlybXdhcmUgZm9yIFBpeFJhY2Vy" aria-selected="false" class="sphinx-tabs-tab code-tab group-tab" id="tab-1-RmlybXdhcmUgZm9yIFBpeFJhY2Vy" name="RmlybXdhcmUgZm9yIFBpeFJhY2Vy" role="tab" tabindex="-1">Firmware for PixRacer</button></div><div aria-labelledby="tab-1-RmlybXdhcmUgZm9yIHNpbXVsYXRpb24=" class="sphinx-tabs-panel code-tab group-tab" id="panel-1-RmlybXdhcmUgZm9yIHNpbXVsYXRpb24=" name="RmlybXdhcmUgZm9yIHNpbXVsYXRpb24=" role="tabpanel" tabindex="0"><div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="nv">DONT_RUN</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>make<span class="w"> </span>px4_sitl<span class="w"> </span>gazebo_uuv_hippocampus
</pre></div>
</div>
</div><div aria-labelledby="tab-1-RmlybXdhcmUgZm9yIFBpeFJhY2Vy" class="sphinx-tabs-panel code-tab group-tab" hidden="true" id="panel-1-RmlybXdhcmUgZm9yIFBpeFJhY2Vy" name="RmlybXdhcmUgZm9yIFBpeFJhY2Vy" role="tabpanel" tabindex="0"><div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span>px4_fmu-v4_default
</pre></div>
</div>
</div></div>
</section>
<section id="sensible-modifications">
<h2>Sensible Modifications<a class="headerlink" href="#sensible-modifications" title="Permalink to this heading"></a></h2>
<section id="battery-invalid">
<h3>Battery Invalid<a class="headerlink" href="#battery-invalid" title="Permalink to this heading"></a></h3>
<p>If the battery parameters are set up correctly and your battery values are not shown in QGroundControl, this might be because the firmware detects the battery errenously as invalid. This happens for example on the BlueROV, where the FCU is powered via USB and the power sense module provides only the measurements but not the supply voltage.</p>
<p>In <code class="code docutils literal notranslate"><span class="pre">analog_battery.cpp:l:83</span></code> the following expression evaluates as <code class="code docutils literal notranslate"><span class="pre">false</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span><span class="w"> </span><span class="n">connected</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">voltage_v</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">BOARD_ADC_OPEN_CIRCUIT_V</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">                     </span><span class="p">(</span><span class="n">BOARD_ADC_OPEN_CIRCUIT_V</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">BOARD_VALID_UV</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">is_valid</span><span class="p">());</span>
</pre></div>
</div>
<p>As a quickfix, replace <code class="code docutils literal notranslate"><span class="pre">is_valid()</span></code> with <code class="code docutils literal notranslate"><span class="pre">true</span></code>.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installing_ros.html" class="btn btn-neutral float-left" title="11.1.1. Installing ROS" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="installing_qgc.html" class="btn btn-neutral float-right" title="11.1.3. Installing QGroundControl" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2023, Thies Lennart Alff, Nathalie Bauschmann.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>